<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HR Law Updates • NYC / NYS</title>
  <style>
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#0b0c10; color:#eef1f7 }
    .wrap{max-width:900px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:22px}
    .sub{color:#9aa3b2;font-size:13px;margin-top:4px}
    input,button{height:40px;border-radius:8px;border:1px solid #232635;background:#151821;color:#eef1f7;padding:0 10px}
    .row{display:flex;gap:8px;margin:10px 0}
    .item{background:#151821;border:1px solid #232635;border-radius:12px;padding:12px;margin-top:10px}
    .meta{color:#9aa3b2;font-size:12px}
    .star{cursor:pointer;float:right}
    .btn{display:inline-block;margin-right:8px;margin-bottom:8px;padding:8px 10px;border:1px solid #232635;border-radius:8px;background:#10141c;color:#eef1f7;text-decoration:none;font-size:13px}
    .pill{display:inline-block;margin-right:6px;margin-bottom:6px;padding:7px 10px;border:1px solid #232635;border-radius:999px;background:#10141c;color:#eef1f7;font-size:12px;cursor:pointer}
    .err{color:#fca5a5}
    .ok{color:#86efac}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>NYC / NYS Employment Law Updates</h1>
    <p id="diag" class="sub">Status: using built-in examples while checking for updates…</p>

    <!-- Quick links -->
    <p>
      <a class="btn" href="https://rules.cityofnewyork.us/" target="_blank" rel="noopener">NYC Rules</a>
      <a class="btn" href="https://council.nyc.gov/legislation/" target="_blank" rel="noopener">NYC Council</a>
      <a class="btn" href="https://a856-cityrecord.nyc.gov/" target="_blank" rel="noopener">City Record</a>
      <a class="btn" href="https://dos.ny.gov/state-register" target="_blank" rel="noopener">NYS Register</a>
      <a class="btn" href="https://dol.ny.gov/news" target="_blank" rel="noopener">NYS DOL News</a>
      <a id="openjson" class="btn" href="./updates.json" target="_blank" rel="noopener">Open updates.json</a>
    </p>

    <!-- Topic chips (one tap fills the search box) -->
    <p id="chips">
      <span class="pill" data-q="wage">Wage</span>
      <span class="pill" data-q="overtime">Overtime</span>
      <span class="pill" data-q="sick leave">Sick Leave</span>
      <span class="pill" data-q="safe leave">Safe Leave</span>
      <span class="pill" data-q="paid family leave">Paid Family Leave</span>
      <span class="pill" data-q="salary transparency">Salary Transparency</span>
      <span class="pill" data-q="retaliation">Retaliation</span>
      <span class="pill" data-q="fair workweek">Fair Workweek</span>
    </p>

    <!-- Search + “Search these official sites” -->
    <div class="row">
      <input id="q" type="search" placeholder="Search: wage, sick leave, salary transparency…" />
      <button id="clear">Clear</button>
    </div>

    <div class="meta" id="site-search" style="margin:6px 0 12px;">
      Search these official sites for "<span id="qshow"></span>":
      <a id="s-rules" class="btn" target="_blank" rel="noopener">NYC Rules</a>
      <a id="s-council" class="btn" target="_blank" rel="noopener">NYC Council</a>
      <a id="s-cityrecord" class="btn" target="_blank" rel="noopener">City Record</a>
      <a id="s-nysreg" class="btn" target="_blank" rel="noopener">NYS Register</a>
      <a id="s-nysdol" class="btn" target="_blank" rel="noopener">NYS DOL</a>
    </div>

    <p id="count" class="meta">0 items</p>
    <div id="list"></div>
  </div>

  <script>
    // ---- Bookmarks ----
    const LS_KEY = 'hrlaw.bookmarks.v1';
    function getBookmarks(){ try{ return new Set(JSON.parse(localStorage.getItem(LS_KEY)||'[]')); }catch{return new Set();}}
    function setBookmarks(set){ localStorage.setItem(LS_KEY,JSON.stringify(Array.from(set))); }

    // ---- Example fallback (renders immediately) ----
    let SEED = [
      {id:'ex1',source:'NYC Council',title:'(Example) Amend Safe and Sick Time Act',date:'2025-09-20',url:'https://council.nyc.gov/legislation/',tags:['NYC','Leave']},
      {id:'ex2',source:'NYC Rules',title:'(Example) Proposed payroll record rule',date:'2025-09-18',url:'https://rules.cityofnewyork.us/',tags:['NYC','Records']}
    ];

    // ---- DOM ----
    const $list=document.getElementById('list');
    const $count=document.getElementById('count');
    const $q=document.getElementById('q');
    const $clear=document.getElementById('clear');
    const $diag=document.getElementById('diag');
    const $qshow=document.getElementById('qshow');

    // Build Google "site:" searches (works everywhere, no scraping)
    function buildSiteLink(site, q){
      const query = (q || '').trim();
      const base = 'https://www.google.com/search?q=';
      // e.g., site:rules.cityofnewyork.us sick leave
      return base + encodeURIComponent(`site:${site} ${query}`);
    }
    function updateSearchLinks(){
      const q = $q.value || '';
      $qshow.textContent = q || '…';
      document.getElementById('s-rules').href      = buildSiteLink('rules.cityofnewyork.us', q);
      document.getElementById('s-council').href    = buildSiteLink('council.nyc.gov', q);
      document.getElementById('s-cityrecord').href = buildSiteLink('a856-cityrecord.nyc.gov', q);
      document.getElementById('s-nysreg').href     = buildSiteLink('dos.ny.gov/state-register', q);
      document.getElementById('s-nysdol').href     = buildSiteLink('dol.ny.gov', q);
    }

    // Render list
    function render(){
      const q=($q.value||'').toLowerCase();
      const bookmarks=getBookmarks();
      let data=SEED.slice().sort((a,b)=>new Date(b.date)-new Date(a.date));
      if(q) data=data.filter(x=>{
        const hay=[x.title,(x.tags||[]).join(' '),x.source].join(' ').toLowerCase();
        return hay.includes(q);
      });
      $count.textContent=`${data.length} item${data.length===1?'':'s'} shown`;
      $list.innerHTML=data.map(x=>{
        const on=bookmarks.has(x.id);
        return `<div class="item">
          <div><strong>${x.title}</strong><span class="star" data-id="${x.id}">${on?'★':'☆'}</span></div>
          <div class="meta">${x.source} · ${x.date}</div>
          <a href="${x.url}" target="_blank" rel="noopener">Open official page</a>
        </div>`;
      }).join('');
      $list.querySelectorAll('.star').forEach(btn=>{
        btn.onclick=()=>{
          const id=btn.getAttribute('data-id');const set=getBookmarks();
          if(set.has(id))set.delete(id);else set.add(id);
          setBookmarks(set);render();
        };
      });
      updateSearchLinks();
    }

    // Topic chips
    document.getElementById('chips').addEventListener('click', e=>{
      const q=e.target.getAttribute('data-q');
      if(!q) return;
      $q.value=q;
      render();
    });

    // Try to load live updates.json (non-blocking, with timeout)
    (function loadUpdates(){
      const ctrl = new AbortController(); const to=setTimeout(()=>ctrl.abort(), 12000);
      fetch('./updates.json?bust='+Date.now(), {signal:ctrl.signal, cache:'no-store'})
        .then(r => r.ok ? r.json() : null)
        .then(json=>{
          clearTimeout(to);
          if(json && Array.isArray(json) && json.length){
            SEED=json;
            $diag.innerHTML = `<span class="ok">Loaded ${SEED.length} items from updates.json</span>`;
          } else if (json && Array.isArray(json)) {
            $diag.innerHTML = `<span class="ok">Loaded 0 items from updates.json (use site search above)</span>`;
          } else {
            $diag.innerHTML = `<span class="err">updates.json not found — showing examples</span>`;
          }
          render();
        })
        .catch(()=>{
          clearTimeout(to);
          $diag.innerHTML = `<span class="err">Fetch failed — showing examples</span>`;
          render();
        });
    })();

    // Events
    $q.addEventListener('input', ()=>{ render(); });
    $clear.addEventListener('click', ()=>{ $q.value=''; render(); });

    // Initial paint
    render();
  </script>
</body>
</html>
