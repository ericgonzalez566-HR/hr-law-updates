<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>HR Law Updates • NYC / NYS</title>
  <meta name="description" content="Mobile-friendly web app for NYC/NYS employment-law updates with official links." />
  <style>
    :root {
      --bg: #0b0c10;
      --card: #151821;
      --muted: #8a92a6;
      --text: #eef1f7;
      --accent: #7aa2ff;
      --border: #232635;
      --good: #34d399;
      --warn: #f59e0b;
      --danger: #ef4444;
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); }
    header { position: sticky; top: 0; z-index: 10; backdrop-filter: blur(8px); background: rgba(11,12,16,.7); border-bottom: 1px solid var(--border); }
    .wrap { max-width: 900px; margin: 0 auto; padding: 14px 16px; }
    h1 { font-size: 20px; margin: 0 0 6px; letter-spacing: .2px; }
    .sub { color: var(--muted); font-size: 13px; margin-top: 2px; }

    .controls { display: grid; grid-template-columns: 1fr minmax(140px, 220px) 48px; gap: 8px; margin-top: 12px; }
    input, select, button { height: 44px; border-radius: 12px; border: 1px solid var(--border); background: var(--card); color: var(--text); padding: 0 12px; font-size: 14px; }
    input::placeholder { color: #9aa3b2; }
    button { cursor: pointer; }
    .tabbar { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
    .tabbar button { background: var(--card); border: 1px solid var(--border); padding: 10px 12px; height: 40px; border-radius: 12px; }
    .tabbar .active { outline: 2px solid var(--accent); }

    main { padding: 14px 16px 80px; }
    .list { display: grid; gap: 10px; }
    .item { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; display: grid; gap: 8px; }
    .row { display: flex; justify-content: space-between; align-items: start; gap: 10px; }
    .title { font-weight: 700; font-size: 16px; line-height: 1.3; }
    .meta { color: var(--muted); font-size: 12px; }
    .tags { display: flex; flex-wrap: wrap; gap: 6px; }
    .tag { font-size: 11px; padding: 6px 8px; border-radius: 999px; border: 1px solid var(--border); background: #11131a; color: #c7d2fe; }
    .actions { display: flex; gap: 8px; }
    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #10141c; color: var(--text); text-decoration: none; font-size: 13px; }
    .btn.primary { border-color: #3557ff44; background: #0e1530; }
    .star { width: 40px; height: 40px; display: inline-grid; place-items: center; border-radius: 12px; border: 1px solid var(--border); background: #10141c; cursor: pointer; }
    .star[data-on="true"] { outline: 2px solid var(--accent); }

    footer { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(180deg, transparent, rgba(11,12,16,.85)); }
    .footwrap { max-width: 900px; margin: 0 auto; padding: 16px; display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .help { color: var(--muted); font-size: 12px; }

    @media (min-width: 700px){
      .controls { grid-template-columns: 1fr 220px 48px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>NYC / NYS Employment Law Updates</h1>
      <div class="sub">Tap any item to open the official page. Use the star to bookmark. Works great on mobile.</div>

      <div class="controls">
        <input id="q" type="search" placeholder="Search: wage, sick leave, PFL, retaliation, salary transparency…" />
        <select id="source">
          <option value="">All sources</option>
          <option>NYC Council</option>
          <option>NYC Rules</option>
          <option>City Record</option>
          <option>NYS Register</option>
          <option>NYS DOL</option>
          <option>US DOL</option>
        </select>
        <button id="clear" title="Clear search">✕</button>
      </div>

      <div class="tabbar">
        <button id="tab-feed" class="active">Feed</button>
        <button id="tab-bookmarks">Bookmarks</button>
      </div>
    </div>
  </header>

  <!-- Quick Links row for instant feedback -->
  <div class="wrap" style="margin-top:10px;">
    <div class="actions" style="flex-wrap:wrap; gap:8px;">
      <a class="btn" href="https://rules.cityofnewyork.us/" target="_blank" rel="noopener">NYC Rules</a>
      <a class="btn" href="https://council.nyc.gov/legislation/" target="_blank" rel="noopener">NYC Council Legislation</a>
      <a class="btn" href="https://a856-cityrecord.nyc.gov/" target="_blank" rel="noopener">City Record (CROL)</a>
      <a class="btn" href="https://dos.ny.gov/state-register" target="_blank" rel="noopener">NYS Register</a>
      <a class="btn" href="https://dol.ny.gov/" target="_blank" rel="noopener">NYS DOL</a>
    </div>
  </div>

  <main>
    <div class="wrap">
      <div class="meta" id="count" style="margin:6px 0 10px;">Loading items…</div>
      <div id="list" class="list"></div>
    </div>
  </main>

  <footer>
    <div class="footwrap">
      <div class="help">Tip: On iPhone (Safari) or Android (Chrome), use “Add to Home Screen” to make this feel like an app.</div>
      <a class="btn" href="https://github.com/new" target="_blank" rel="noopener">Deploy to GitHub Pages</a>
    </div>
  </footer>

  <script>
    // --- Mock data to make the app usable now ---
    let SEED = [
      {
        id: "nycc-1",
        source: "NYC Council",
        title: "(Example) Intro XXXX — Amend Earned Safe and Sick Time Act",
        date: "2025-09-20T14:00:00Z",
        url: "https://council.nyc.gov/legislation/",
        tags: ["NYC","Leave","Sick Time"]
      },
      {
        id: "nycr-1",
        source: "NYC Rules",
        title: "(Example) Proposed rule on payroll records retention",
        date: "2025-09-18T13:00:00Z",
        url: "https://rules.cityofnewyork.us/",
        tags: ["NYC","Records","Compliance"]
      },
      {
        id: "crol-1",
        source: "City Record",
        title: "(Example) Notice of Public Hearing: DCWP — Fair Workweek clarifications",
        date: "2025-09-16T16:00:00Z",
        url: "https://a856-cityrecord.nyc.gov/",
        tags: ["NYC","Scheduling","DCWP"]
      },
      {
        id: "nysr-1",
        source: "NYS Register",
        title: "(Example) Proposed rule: Minimum Wage Order update (Statewide)",
        date: "2025-09-10T12:00:00Z",
        url: "https://dos.ny.gov/state-register",
        tags: ["NYS","Wage","Minimum Wage"]
      },
      {
        id: "nysdol-1",
        source: "NYS DOL",
        title: "(Example) NYS DOL guidance: Salary transparency FAQs updated",
        date: "2025-09-08T12:00:00Z",
        url: "https://dol.ny.gov/",
        tags: ["NYS","Salary Transparency","Guidance"]
      },
      {
        id: "usdol-1",
        source: "US DOL",
        title: "(Example) Final rule on overtime threshold (federal context)",
        date: "2025-08-29T15:00:00Z",
        url: "https://www.dol.gov/",
        tags: ["Federal","FLSA","Overtime"]
      }
    ];

    // Try to load live data from updates.json if it exists
    // This lets your GitHub Pages site "do something" without a backend.
    // Create a file named updates.json in the same repo root.
    // Example content is below in the chat.
    fetch('./updates.json?cacheBust=' + Date.now())
      .then(r => (r.ok ? r.json() : Promise.reject(r.status)))
      .then(json => { if (Array.isArray(json) && json.length) { SEED = json; render(); } })
      .catch(()=>{/* fallback to built-in SEED */});

    // --- State ---
    const $list = document.getElementById('list');
    const $q = document.getElementById('q');
    const $source = document.getElementById('source');
    const $clear = document.getElementById('clear');
    const $tabFeed = document.getElementById('tab-feed');
    const $tabBookmarks = document.getElementById('tab-bookmarks');

    const LS_KEY = 'hrlaw.bookmarks.v1';

    function getBookmarks(){
      try { return new Set(JSON.parse(localStorage.getItem(LS_KEY) || '[]')); }
      catch(e){ return new Set(); }
    }
    function setBookmarks(set){
      localStorage.setItem(LS_KEY, JSON.stringify(Array.from(set)));
    }

    let TAB = 'feed';

    function fmtDate(iso){
      try {
        const d = new Date(iso);
        return d.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric'});
      } catch { return iso; }
    }

    function itemTemplate(item, bookmarks){
      const on = bookmarks.has(item.id);
      return `
        <div class="item" data-id="${item.id}">
          <div class="row">
            <div class="title">${escapeHtml(item.title)}</div>
            <div class="meta">${fmtDate(item.date)}</div>
          </div>
          <div class="meta">${item.source} · ${escapeHtml(item.tags.join(' • '))}</div>
          <div class="row">
            <div class="actions">
              <a class="btn primary" href="${item.url}" target="_blank" rel="noopener">Open official page</a>
            </div>
            <button class="star" aria-label="Bookmark" data-on="${on}" data-id="${item.id}">★</button>
          </div>
        </div>`;
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
    }

    function render(){
      const q = ($q.value || '').toLowerCase();
      const src = $source.value;
      const bookmarks = getBookmarks();

      let data = SEED.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));

      if (TAB === 'bookmarks') {
        data = data.filter(x => bookmarks.has(x.id));
      }
      if (src) data = data.filter(x => x.source === src);
      if (q) data = data.filter(x =>
        x.title.toLowerCase().includes(q) ||
        x.tags.join(' ').toLowerCase().includes(q)
      );

      const $count = document.getElementById('count');
      $count.textContent = `${data.length} item${data.length===1?'':'s'} shown`;

      if (data.length === 0){
        $list.innerHTML = `<div class="meta" style="padding:20px; text-align:center;">No items match. Try clearing filters.</div>`;
        return;
      }

      $list.innerHTML = data.map(x => itemTemplate(x, bookmarks)).join('');

      // wire bookmark buttons
      $list.querySelectorAll('.star').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const set = getBookmarks();
          if (set.has(id)) set.delete(id); else set.add(id);
          setBookmarks(set);
          render();
        });
      });
    }
      if (src) data = data.filter(x => x.source === src);
      if (q) data = data.filter(x =>
        x.title.toLowerCase().includes(q) ||
        x.tags.join(' ').toLowerCase().includes(q)
      );

      if (data.length === 0){
        $list.innerHTML = `<div class="meta" style="padding:20px; text-align:center;">No items match. Try clearing filters.</div>`;
        return;
      }

      $list.innerHTML = data.map(x => itemTemplate(x, bookmarks)).join('');

      // wire bookmark buttons
      $list.querySelectorAll('.star').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const set = getBookmarks();
          if (set.has(id)) set.delete(id); else set.add(id);
          setBookmarks(set);
          render();
        });
      });
    }

    // events
    $q.addEventListener('input', render);
    $source.addEventListener('change', render);
    $clear.addEventListener('click', () => { $q.value=''; $source.value=''; render(); });

    $tabFeed.addEventListener('click', () => { TAB = 'feed'; $tabFeed.classList.add('active'); $tabBookmarks.classList.remove('active'); render(); });
    $tabBookmarks.addEventListener('click', () => { TAB = 'bookmarks'; $tabBookmarks.classList.add('active'); $tabFeed.classList.remove('active'); render(); });

    render();

    // --- Future hook: swap SEED for live data from your backend ---
    // fetch('https://your-endpoint.example.com/updates').then(r=>r.json()).then(data => { /* set items + render */ })
  </script>
</body>
</html>
